name: Sync Release Assets to Branch

on:
  release:
    types: [published]  # Trigger when a new release is published

jobs:
  update-branch:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout the branch you want to update
      - name: Checkout branch
        uses: actions/checkout@v3
        with:
          ref: main
          persist-credentials: true

      # 2. Install GitHub CLI for easier asset download
      - name: Install GitHub CLI
        run: sudo apt-get install -y gh

      # 3. Download release assets
      - name: Download release assets
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          RELEASE_ID=$(gh release view $GITHUB_REF_NAME --json id -q ".id")
          mkdir -p release-assets
          gh release download $GITHUB_REF_NAME --dir release-assets

      # 4. Copy assets into repo (replace existing files)
      - name: Replace files in repo
        run: |
          cp release-assets/* .

      # 5. Commit and push changes back to branch
      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
